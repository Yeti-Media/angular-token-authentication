!function(){"use strict";var a=angular.module("tokenAuthentication",["ngCookies"]);a.run(["$rootScope",function(a){a.tokenAuthParams={tokenDuration:30,idleTime:20,keyPrefix:"tokenAuth",accessTokenKey:"accessToken"}}]),a.factory("$sessionHandler",["$cookies","$rootScope",function(a,b){var c=function(a){return b.tokenAuthParams.keyPrefix+"_"+a},d="accessToken",e={keys:{},loggedIn:function(){return a[c(d)]?!0:!1},setValue:function(e,f,g){a[c(e)]=f,this.keys.hasOwnProperty("expiration")||this.updateExpiration(),this.keys[e]=g,e===d&&(this.setIdleTimer(),b.$broadcast("tokenAuth:loggedIn"))},setValues:function(a){var b=this;angular.forEach(a,function(a,c){"object"==typeof a?b.setValue(c,a.value,a.remember):b.setValue(c,a)})},getValue:function(b){return a[c(b)]},setAccessToken:function(a,b){this.setValue(c(d),a,b)},getAccessToken:function(){return this.getValue(d)},updateExpiration:function(){var d=new Date,e=b.tokenAuthParams.sessionDuration;e&&(d.setMinutes(d.getMinutes()+e),a[c("expiration")]=d.getTime().toString(),this.keys.expiration=!1)},checkExpiration:function(){var b=new Date,d=c("expiration");return a[d]&&parseInt(a[d],10)<b.getTime()?(this.clean(),!0):!1},setIdleTimer:function(){var a=b.tokenAuthParams.idleTime,c=this;a&&(c.idleInterval&&clearInterval(c.idleInterval),angular.element(document).ready(function(){var b=0;c.idleInterval=setInterval(function(){b+=1,b>=a&&c.clean()},6e4),angular.element(this).on("mousemove",function(){b=0}),angular.element(this).on("keypress",function(){b=0})}))},clean:function(e){angular.forEach(this.keys,function(f,g){(e||!f)&&(delete a[c(g)],g===d&&b.$broadcast("tokenAuth:loggedOut"))}),this.idleInterval&&clearInterval(this.idleInterval)}};return b.$on("logout",e.clean),e}]),angular.module("tokenAuthResource",["ngResource","tokenAuthentication"]).factory("$tokenAuthResource",["$rootScope","$resource","$sessionHandler",function(a,b,c){return function(){var d=b.apply(this,arguments),e=["get","save","query","remove","delete"];return 3===arguments.length&&angular.forEach(arguments[2],function(a,b){e.push(b)}),angular.forEach(e,function(b){var e=d[b];d[b]=function(){var b=Array.prototype.slice.call(arguments);0===b.length?b.push({}):"object"!=typeof b[0]&&(b[0]={}),b[0][a.tokenAuthParams.accessTokenKey]=c.getAccessToken(),e.apply(this,b)}}),d}}])}();