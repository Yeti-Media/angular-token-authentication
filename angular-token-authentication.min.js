!function(){"use strict";var a=angular.module("tokenAuthentication",["ngCookies"]);a.value("tokenAuthParams",{sessionDuration:30,idleTime:20,accessTokenKey:"accessToken"}),a.factory("sessionHandler",["$rootScope","$window","tokenAuthParams",function(a,b,c){var d=function(a){return"tokenAuth_"+a},e="accessToken",f=d("expiration"),g=b.sessionStorage,h={keys:{},loggedIn:function(){return g[d(e)]?!0:!1},setValue:function(b,c,f){g[d(b)]=c,angular.equals(this.keys,{})&&(this.setExpiration(),this.setIdleTimer()),this.keys[b]=f,b===e&&a.$broadcast("tokenAuth:loggedIn")},setValues:function(a){var b=this;angular.forEach(a,function(a,c){"object"==typeof a?b.setValue(c,a.value,a.remember):b.setValue(c,a)})},getValue:function(a){return g[d(a)]},setAccessToken:function(a,b){this.setValue(d(e),a,b)},getAccessToken:function(){return this.getValue(e)},setExpiration:function(){var a=new Date,b=c.sessionDuration;b&&(a.setMinutes(a.getMinutes()+b),g[f]=a.getTime().toString(),this.keys.expiration=!1)},checkExpiration:function(){var a=new Date;return g[f]&&parseInt(g[f],10)<a.getTime()?(this.clean(),!0):!1},setIdleTimer:function(){var a=c.idleTime,b=this;a&&(b.idleInterval&&clearInterval(b.idleInterval),angular.element(document).ready(function(){var c=0;b.idleInterval=setInterval(function(){c+=1,c>=a&&b.clean()},6e4),angular.element(this).on("mousemove",function(){c=0}),angular.element(this).on("keypress",function(){c=0})}))},clean:function(b){var c=this,f=angular.copy(this.keys);angular.forEach(f,function(f,h){(b||!f)&&(delete g[d(h)],delete c.keys[h],h===e&&a.$broadcast("tokenAuth:loggedOut"))}),this.idleInterval&&clearInterval(this.idleInterval)}};return a.$on("tokenAuth:logout",h.clean),h}]),angular.module("tokenAuthResource",["ngResource","tokenAuthentication"]).factory("tokenAuthResource",["$resource","sessionHandler","tokenAuthParams",function(a,b,c){return function(){var d=a.apply(this,arguments),e=["get","save","query","remove","delete"];return 3===arguments.length&&angular.forEach(arguments[2],function(a,b){e.push(b)}),angular.forEach(e,function(a){var e=d[a];d[a]=function(){var a=Array.prototype.slice.call(arguments);b.checkExpiration()||(0===a.length?a.push({}):"object"!=typeof a[0]&&(a[0]={}),a[0][c.accessTokenKey]=b.getAccessToken(),e.apply(this,a))}}),d}}])}();