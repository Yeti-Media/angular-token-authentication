!function(){"use strict";var a=angular.module("tokenAuthentication",["ngCookies"]);a.value("tokenAuthParams",{sessionDuration:30,idleTime:20,accessTokenKey:"access_token"}),a.factory("sessionHandler",["$rootScope","$window","tokenAuthParams",function(a,b,c){var d="access_token",e=b.sessionStorage,f=function(a,b,c){var d=e.tokenAuth_session?JSON.parse(e.tokenAuth_session):{};d[a]={value:b,remember:c||!1},e.tokenAuth_session=JSON.stringify(d)},g={empty:function(){return"{}"===e.tokenAuth_session},setValue:function(b,c,e){this.empty()&&(this.setExpiration(),this.setIdleTimer()),f(b,c,e),b===d&&a.$broadcast("tokenAuth:loggedIn")},setValues:function(a){var b=JSON.parse(e.tokenAuth_session);angular.forEach(a,function(a,c){"object"==typeof a&&a.hasOwnProperty("value")||(a={value:a,remember:!1}),b[c]=a}),e.tokenAuth_session=JSON.stringify(b)},getValue:function(a){var b=JSON.parse(e.tokenAuth_session)[a];return b?b.value:null},setAccessToken:function(a,b){this.setValue(d,a,b)},getAccessToken:function(){return this.getValue(d)},setExpiration:function(){var a=new Date,b=c.sessionDuration;b&&(a.setMinutes(a.getMinutes()+b),e.tokenAuth_expiration=a.getTime().toString())},checkExpiration:function(){var a=new Date;return e.tokenAuth_expiration&&parseInt(e.tokenAuth_expiration,10)<a.getTime()?(this.clean(),!0):!1},setIdleTimer:function(){var a=c.idleTime,b=this;a&&(b.idleInterval&&clearInterval(b.idleInterval),angular.element(document).ready(function(){var c=0;b.idleInterval=setInterval(function(){c+=1,c>=a&&b.clean()},6e4),angular.element(this).on("mousemove",function(){c=0}),angular.element(this).on("keypress",function(){c=0})}))},clean:function(b){var c=JSON.parse(e.tokenAuth_session);angular.forEach(c,function(e,f){(b||!e.remember)&&(delete c[f],f===d&&a.$broadcast("tokenAuth:loggedOut"))}),e.tokenAuth_session=JSON.stringify(c),delete e.tokenAuth_expiration,this.idleInterval&&clearInterval(this.idleInterval)}};return a.$on("tokenAuth:logout",g.clean),e.tokenAuth_session||(e.tokenAuth_session="{}"),g}]),angular.module("tokenAuthResource",["ngResource","tokenAuthentication"]).factory("tokenAuthResource",["$resource","sessionHandler","tokenAuthParams",function(a,b){return{build:function(){var c=a.apply(this,arguments),d=["get","save","query","remove","delete"];return 3===arguments.length&&angular.forEach(arguments[2],function(a,b){d.push(b)}),arguments.length>2&&!b.checkExpiration()&&angular.forEach(arguments[2],function(a){a.headers={Authorization:function(){return"Bearer "+b.getAccessToken()}}}),this.wrapActions(c,d),c},wrapActions:function(a,c){angular.forEach(c,function(c){var d=a[c];a[c]=function(){var c=Array.prototype.slice.call(arguments);return b.checkExpiration()||(0===c.length?c.push({}):"object"!=typeof c[0]&&c.unshift({})),d.apply(a,c)}})}}}])}();